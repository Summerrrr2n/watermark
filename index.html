<!DOCTYPE html>
<html>
<head>
  <title>Add Water Mark</title>
  <!-- 引入组件库 -->
  <script src="https://unpkg.com/vue@2"></script>
  <script src="https://unpkg.com/element-ui@2.15.7/lib/index.js"></script>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.7/lib/theme-chalk/index.css">
  <style>
    #app {
      max-width:1920px;
    }
    canvas{
      max-width: 25%;
    }
    .demonstration{
      line-height: 40px;
    }
    .block{
      width: 500px;
      padding: 15px 20px;
    }
    .block>*:last-child{
      float: right;
      width: 70%;
    }
  </style>
</head>
<body>
  <div id="app">
    <el-upload
      class="upload-demo"
      action=""
      :show-file-list="false"
      :accept="acceptFile"
      :before-upload="beforeUpload"
      multiple
      drag
      :limit="10"
      :on-exceed="handleExceed">
      <i class="el-icon-upload"></i>
      <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
      <div class="el-upload__text">只能上传jpg/png文件，且不超过10张</div>
    </el-upload>
    <div class="block">
      <span class="demonstration">文字</span>
      <el-input placeholder="请输入水印文字" v-model="text" @input="handleDrawText"></el-input>
    </div>
    <div class="block">
      <span class="demonstration">大小</span>
      <el-slider v-model="size" :min="10" :format-tooltip="formatTooltip" @input="handleDrawText"></el-slider>
    </div>
    <div class="block">
      <span class="demonstration">角度</span>
      <el-slider v-model="angle" :min="0" :max="360" @input="handleDrawText"></el-slider>
    </div>
    <div class="block">
      <span class="demonstration">间距</span>
      <el-slider v-model="space" :min="0" :max="3" :step="0.05" @input="handleDrawText"></el-slider>
    </div>
    <div class="block">
      <span class="demonstration">颜色</span>
      <el-color-picker v-model="color" show-alpha @input="handleDrawText"></el-color-picker>
    </div>
    <div v-for="(img, index) in imgList" :id="'shade_'+index" class="shadow">
      <canvas :id="'canvas_'+index"></canvas>
    </div>
  </div>

  <script src="./resource/js/file.js" type="text/javascript"></script>
  <script src="./resource/js/paint.js" type="text/javascript"></script>
  <script>
    let app = new Vue({
      el: '#app',
      data: {
        size:25,
        angle:45,
        imgList:[],
        acceptFile:"png,jpg,jpeg",
        fileNum: 0,
        color:'rgba(249, 183, 38, 0.66)',
        text:'',
        space:0.5,
      },
      methods: {
        beforeUpload(file){
          console.log(file)
          let fileType = file.type
          if (fileType != 'image/png' && fileType != 'image/jpeg'){
            this.$message({type:'info',message:'仅支持png/jpg文件'})
            return false
          }
          this.imgList.push(file)
          readFile(file, this.fileNum++)
          return false
        },
        handleExceed(files, fileList) {
          this.$message({type:'info',message:'最多上传10张图片'})
        },
        handleDrawText() {
          console.log()
          redraw()
        },
        formatTooltip(val) {
          return val / 100;
        }
      }
    })
  </script>
</body>
</html>